# ExploreWithMe :dizzy: 

[_ссылка на пул-реквест_](https://github.com/Christina1407/java-explore-with-me/pull/5)

Приложение — афиша. Можно предложить какое-либо событие и собрать компанию для участия в нём.

## Администрирование локаций :globe_with_meridians:

Теперь администратор может добавлять в отдельную таблицу `places` конкретные локации(места) — города, театры, концертные залы и другие.

_Пример: 55.826837, 37.389086, 170 м, Крокус Сити Холл, Concert hall, ALL, indoors_;

**Place**:

_latitude*_ - широта места;

_longitude*_ - долгота места;

_radius*_ - радиус области покрытия в метрах;

_name*_ - название места;

_type*_ - типы локаций хранятся в отдельной таблице, которая предварительно заполнена: Cinema, Concert hall, Theatre, For children, Exhibition, Sport, Stand-up, Quest, Park, City, Village, Restaurant, Cafe, Hotel, Beauty salon, Shopping center, Tourist club, Yacht club, Rental Agency, Boat station, Christmas and New Year, Place of interest, Country club;

_season_ - сезон, когда доступно это место, если круглогодично или не указано, то ALL.

Enum: SUMMER, WINTER, SPRING, AUTUMN, ALL;

_feature_ - особенности локации. Например, indoors, outdoors, around the clock, free.

Пользователь при создании события, как и раньше, указывает только координаты места проведения - **location** в dto, поля **lat** и **lon** в таблице `events`. Но теперь он может добавить к событию ещё и
конкретные места, которые уже есть в приложении - **places** в dto. Когда пользователь создаёт событие, при введении координат, отобразится список мест, в область
которых попадают координаты => запрос на бэк GET /admin/places?lat= _ &lon= _. Из списка пользователь может выбрать одно/несколько мест или вообще не выбирать =>
при запросе на сохранение нового события в **NewEventDto** добавится лист id мест, которые выбрал пользователь. Та же самая логика при изменении координат во время обновления событий.


**Администратор**:
- добавление места POST /admin/places;
- изменение места PATCH /admin/places/{placeId};
- удаление места, в котором нет событий DELETE /admin/places/{placeId};
- получение мест со всеми событиями, которые относятся к этим местам: GET admin/places и GET admin/places/{placeId};
- поиск мест с возможностью фильтрации GET admin/places/filters?text - текст для поиска в названии и особенностях, types - список идентификаторов типов мест,
comparison и radius - радиус места больше, меньше или равен определённому значению, season - сезон;
- поиск событий в заданной области и в определённых местах: добавление фильтров в эндпоинт GET /admin/events: 
  - область поиска -> lat, lon, radius - координаты центра и радиус поиска;
  - поиск событий в конкретных местах -> places - список идентификаторов мест;
- поиск мест, в область которых попадают координаты, введённые пользователем GET /admin/places?lat= _ &lon= _ .

**Любой пользователь**:

- просмотр существующих мест для проведения событий с опубликованными событиями, которые относятся к этим местам: GET /places и GET /places/{placeId}
- поиск событий в заданной области и в определённых местах: добавление фильтров в публичный эндпоинт GET /events:
  - область поиска -> lat, lon, radius - координаты центра и радиус поиска;
  - поиск событий в конкретных местах -> places - список идентификаторов мест.

**Авторизованный пользователь**:
- создание событий осталось таким же POST /users/{userId}/events, но теперь пользователь может добавить к событию определённые места.

## Основной сервис :eyes:
   API основного сервиса разделён на три части:                                                                                                                                                                                                         
                                                                                                                                                                                                                                                        
   - **публичная** - доступна без регистрации любому пользователю сети;                                                                                                                                                                                 
   - **закрытая** - доступна только авторизованным пользователям;                                                                                                                                                                                       
   - **административная** - для администраторов сервиса.                                                                                                                                                                                                
                                                                                                                                                                                                                                                        
   |                    Любой пользователь                     |                                Авторизованные пользователи                                 |                                Администраторы сервиса                                 |   
   |:---------------------------------------------------------:|:------------------------------------------------------------------------------------------:|:-------------------------------------------------------------------------------------:|   
   |                 Просмотр подборок событий                 | Добавление новых событий, их редактирование и получение полной информации о своих событиях |           Создание и удаление пользователей, получение информации о них               |   
   |      Получение информации о существующих категориях       | Создание и отмена заявок на участие в чужих событиях, получение информации о своих заявках | Получение информации о событиях по заданным фильтрам, отклонение и публикация событий |   
   | Получение информации о событиях с возможностью фильтрации |   Получение информации о запросах на участие в своём событии, их подтверждение и отмена    |                            Добавление и удаление категорий                            |   
   |                                                           |                                                                                            |                   Создание, обновление и удаление подборок событий                    |   



**Схема базы данных**

![alt text](ewmDB.png )
`users` - данные о пользователях:

_user_id_ - первичный ключ, идентификатор записи;

_email_ - почтовый адрес;

_name_ - имя.

`events` - данные о событиях:

_event_id_ - первичный ключ, идентификатор записи;

_annotation_ - краткое описание;

_category_id_ - id категории, к которой относится событие;

_description_ - полное описание события;

_event_date_ - дата и время, на которые намечено событие (не может быть раньше, чем через два часа от текущего момента);

_created_date_ - дата и время создания события;

_published_date_ - дата и время публикации события;

_initiator_id_ - id пользователя - создателя события;

_paid (default: false)_ - нужно ли оплачивать участие в событии;

_participant_limit (default: 0)_ - ограничение на количество участников. Ноль означает отсутствие ограничения;

_request_moderation (default: true)_ - нужна ли премодерация заявок на участие. _true_ - все заявки будут ожидать подтверждения инициатором события, _false_ - будут подтверждаться автоматически;

_title_ - заголовок события;

_state_ - список состояний жизненного цикла события: PENDING, PUBLISHED, CANCELED.

_lat_ - широта места проведения события;

_lon_ - долгота места проведения события.

`categories` - каждое событие должно относиться к какой-то из закреплённых в приложении категорий;

`places` - места для проведения событий, добавленные администратором:

_place_id_ - первичный ключ, идентификатор записи;

_latitude_ - широта;

_longitude_ долгота;

_radius_ - радиус области покрытия места;

_name_ - название места;

_type_id_ - id типа места;

_season(default: ALL)_ - в какой сезон доступно место;

_feature_ - особенности: indoors, outdoors, around the clock, free.

`place_type` - возможные типы локации, заполняется предварительно.

`events_places` - вспомогательная таблица для связи событий и мест. _ManyToMany_: у события может быть указано несколько мест, в одном месте могут проводиться несколько событий.
_Пример: концерт в Зелёном театре, в Парке Горького_.

`requests` - заявки на участие в событии:

_request_id_ - первичный ключ, идентификатор записи;

_created_date_ - дата и время создания заявки;

_event_id_ - идентификатор события;

_requester_id_ - идентификатор пользователя, отправившего заявку;

_status_ - статус заявки: PENDING, CONFIRMED, REJECTED, CANCELED.

`compilations` - подборки событий:

_compilation_id_ - первичный ключ, идентификатор записи;    

_pinned_(default: false) -  закреплена ли подборка на главной странице сайта;

_title_ - заголовок подборки.

`events_compilations` - вспомогательная таблица для связи событий и подборок. _ManyToMany_: событие может быть в нескольких подборках, в подборке - несколько событий.


## Сервис статистики :bar_chart:

Хранит количество просмотров и позволяет делать различные выборки для анализа работы приложения.

**Схема базы данных**

![alt text](statDB.png )

`apps` - данные о сервисах, для которых собирается статистика:

_app_id_ - первичный ключ, идентификатор записи;

_name_ — название сервиса.

`hits` - данные о просмотрах:

_hit_id_ - первичный ключ, идентификатор записи;

_uri_ - URI, для которого был осуществлен запрос;

_app_id_ — идентификатор сервиса, для которого записывается информация;

_ip_ — IP-адрес пользователя, осуществившего запрос;

_timestamp_ — дата и время, когда был совершен запрос к эндпоинту.
